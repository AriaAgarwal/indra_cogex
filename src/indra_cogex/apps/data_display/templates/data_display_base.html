{% from "auth_macros.html" import login_overlay %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INDRA CoGEx</title>

    <!-- Bootstrap 5 CSS -->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <!-- Indralab-vue, for access to <statement> component -->
    <script src="https://bigmech.s3.amazonaws.com/indra-db/indralabvue-latest/IndralabVue.umd.min.js"></script>
    <link href="https://bigmech.s3.amazonaws.com/indra-db/indralabvue-latest/IndralabVue.css" rel="stylesheet">

    {% block header_scripts %}
    {% endblock %}
</head>
<body>
    {% block page_header %}
    {{ login_overlay(url_prefix="") }}
    <script>
      function handle_success(type, resp_data) {
        if (type === "login") {
          const btn = document.querySelector("#loginout-button");
          btn.innerHTML = 'Logout';
          btn.onclick = () => {return trigger_logout()};
          report_login_result(''); // clear the login result message
        }
        else if (type === "register") {
          trigger_login()
        }
        else { // logout
          const btn = document.querySelector("#loginout-button");
          btn.innerHTML = 'Login';
          btn.onclick = () => {return trigger_login()};
        }
      }

      function trigger_login(type=null, data=null) {
        return login(handle_success, trigger_unchecked_login)
      }

      function trigger_unchecked_login(type=null, data=null) {
        return login(handle_success, trigger_unchecked_login, true)
      }

      function trigger_logout() {
        return logout(handle_success)
        }
    </script>

    <style>
      #loginout-button {
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .no-horiz-pad {
        padding-left: 0;
        padding-right: 0;
      }
    </style>

    <header class="bg-white border-bottom shadow-sm fixed-top no-horiz-pad">
      <div class="d-flex flex-row align-items-center">
        {% block extend_header %}
        {% endblock %}
        <nav class="d-inline-flex p-2">
        <a class="p-2 text-dark" href="https://emmaa.readthedocs.io/en/latest/dashboard/index.html" target="_blank">Help</a>
        <a class="p-2 text-dark" href="#about">About</a>
        <a class="p-2 text-dark" href="/demos">Demos</a>
        <a class="p-2 text-dark" href="/doc">REST API</a>
      </nav>
        <div class="d-inline-flex button-container p-2">
          <button class="btn btn-primary"
                onclick="return {% if user_email %}trigger_logout(){% else %}trigger_login(){% endif %};"
                id="loginout-button">
            {% if user_email %}
              Logout
            {% else %}
              Login
            {% endif %}
          </button>
        </div>
      </div>
    </header>
    {% endblock %}
    <div class="container" id="vue-app">
        <!-- Copied structure from emmaa evidence:
            - BootStrap card
                - Card body: Table
                    - Table header: None
                    - Table row: one <statement> per row i.e. one column per row with <statement> in it -->
        <div class="card">
            <div class="card-header">
                <h3>CoGEx Statements</h3>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Statement</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% raw %}
                        <tr v-for="st_obj in this.$data.stmts">
                            <td>
                                <statement
                                        :evidence="st_obj.ev_array"
                                        :english="st_obj.english"
                                        :hash="st_obj.hash"
                                        :sources="st_obj.sources"
                                        :total_evidence="st_obj.total_evidence"
                                        :badges="st_obj.badges"
                                ></statement>
                            </td>
                        </tr>
                        {% endraw %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        let app = new Vue({
            el: '#vue-app',
            data: {
                stmts: [
                    {% for ev_array, english, hash_str, sources, total_evidence, badges in stmts %}
                        {
                            ev_array: {{ ev_array|safe }},
                            english: {{ english|safe }},
                            hash: {{ hash_str|safe }},
                            sources: {{ sources|safe }},
                            total_evidence: {{ total_evidence|int }},
                            badges: {{ badges|safe }}
                        },
                    {% endfor %}
                ]
            }
        });
        Vue.prototype.$stmt_hash_url = "/";  // Should not be needed as all evidences come with the query result
        Vue.prototype.$curation_url = "{{ url_for('submit_curation_endpoint', hash_val='') }}";
    </script>
</body>
</html>